;FASM source
include 'ppro.inc'
;-------------------------------------------------------
ORG 256
 MOV    AH,9            ; print title
 LEA    DX,[txt_title]
 INT    21H

 FNINIT                 ; fill FPU stack
 FLDLG2
 FLD    ST0
 FADD   ST0,ST0
 FLDLN2
 FLD    ST0
 FADD   ST0,ST0
 FLDL2E
 FLD    ST0
 FADD   ST0,ST0
 FLDPI

 XOR    AX,AX           ; set up illegal handler
 MOV    DS,AX
 MOV    SI,[6 * 4 + 0]
 MOV    DI,[6 * 4 + 2]
 MOV    AX,CS
 MOV    WORD [6 * 4 + 0],illegal
 MOV    WORD [6 * 4 + 2],AX
 MOV    DS,AX
 MOV    ES,AX
 MOV    [iloffset],SI
 MOV    [ilsegment],DI

 MOV    [stdstack],SP
 MOV    [pointer],tab

next:
 MOV    BX,[pointer]    ; pick next table item
 ADD    [pointer],2
 MOV    DI,[BX]
 TEST   DI,DI
 JZ     quit
 MOV    [pointer2],DI
 MOV    AH,9            ; print title
 LEA    DX,[txt_pre]
 INT    21H
 MOV    DX,DI
 INT    21H
 MOV    AH,9
 LEA    DX,[txt_wait]
 INT    21H
next2:
 MOV    DI,[pointer2]   ; pick next table item
 MOV    CX,-1

 MOV    AL,'$'          ; skip title
 REPNZ  SCASB

 TEST   WORD [DI],CX
 JZ     next
 MOV    [jump],DI       ; perform test

again:
 MOV    AL,0C3H         ; skip code
 REPNZ  SCASB
 MOV    [pointer2],DI   ; perform test

 MOV    SI,DI
@@:
 LODSB
 CMP    AL,'$'
 JE     @F
 CMP    AL,'z'
 JNA    @B
 JMP    again
@@:

 CALL   [jump]
 JZ     fail

okay:
 MOV    AH,2
 MOV    DL,'/'
 INT    21H
 JMP    next2

illegal:
 MOV   SP,[stdstack]    ; reset stack, then fail

fail:
 MOV    AH,9
 MOV    DX,[pointer2]
 INT    21H
 MOV    AH,2
 MOV    DL,'!'
 INT    21H
 MOV    DL,' '
 INT    21H
 JMP    next2

quit:

 MOV    SI,[iloffset]   ; restore illegal handler
 MOV    DI,[ilsegment]
 XOR    AX,AX
 MOV    DS,AX
 MOV    WORD [6 * 4 + 0],SI
 MOV    WORD [6 * 4 + 2],DI

 FNINIT                 ; empty FPU stack

 MOV    AX,4C00H        ; exit
 INT    21H
;-------------------------------------------------------
; Data

tab:
 DW     test_force_okay
 DW     test_force_fail
 DW     test_cmovb
 DW     test_cmovnb
 DW     test_cmovz
 DW     test_cmovnz
 DW     test_fcomi
 DW     test_fcomip
 DW     test_fucomi
 DW     test_fucomip
 DW     test_fcmovb
 DW     test_fcmovnb
 DW     test_fcmove
 DW     test_fcmovne
 DW     test_fcmovu
 DW     test_fcmovnu
 DW     test_fcmovbe
 DW     test_fcmovnbe
 DW     0

txt_pre: db 10,13," testing $"
txt_wait: db " $"
txt_title: db "PentiumPro instruction set tester$"

;-------------------------------------------------------
test_cmovb:
 DB "CMOVB$"
 TCMOVB AX,BX
 DB "AX,BX$"
 TCMOVB AX,CX
 DB "AX,CX$"
 TCMOVB AX,DX
 DB "AX,DX$"
 TCMOVB AX,SI
 DB "AX,SI$"
 TCMOVB AX,DI
 DB "AX,DI$"
 TCMOVB AX,BP
 DB "AX,BP$"
 TCMOVB AX,SP
 DB "AX,SP$"
 TCMOVB BX,AX
 DB "BX,AX$"
 TCMOVB BX,CX
 DB "BX,CX$"
 TCMOVB BX,DX
 DB "BX,DX$"
 TCMOVB BX,SI
 DB "BX,SI$"
 TCMOVB BX,DI
 DB "BX,DI$"
 TCMOVB BX,BP
 DB "BX,BP$"
 TCMOVB BX,SP
 DB "BX,SP$"
 TCMOVB CX,AX
 DB "CX,AX$"
 TCMOVB CX,BX
 DB "CX,BX$"
 TCMOVB CX,DX
 DB "CX,DX$"
 TCMOVB CX,SI
 DB "CX,SI$"
 TCMOVB CX,DI
 DB "CX,DI$"
 TCMOVB CX,BP
 DB "CX,BP$"
 TCMOVB CX,SP
 DB "CX,SP$"
 TCMOVB DX,AX
 DB "DX,AX$"
 TCMOVB DX,BX
 DB "DX,BX$"
 TCMOVB DX,CX
 DB "DX,CX$"
 TCMOVB DX,SI
 DB "DX,SI$"
 TCMOVB DX,DI
 DB "DX,DI$"
 TCMOVB DX,BP
 DB "DX,BP$"
 TCMOVB DX,SP
 DB "DX,SP$"
 TCMOVB SI,AX
 DB "SI,AX$"
 TCMOVB SI,BX
 DB "SI,BX$"
 TCMOVB SI,CX
 DB "SI,CX$"
 TCMOVB SI,DX
 DB "SI,DX$"
 TCMOVB SI,DI
 DB "SI,DI$"
 TCMOVB SI,BP
 DB "SI,BP$"
 TCMOVB SI,SP
 DB "SI,SP$"
 TCMOVB DI,AX
 DB "DI,AX$"
 TCMOVB DI,BX
 DB "DI,BX$"
 TCMOVB DI,CX
 DB "DI,CX$"
 TCMOVB DI,DX
 DB "DI,DX$"
 TCMOVB DI,SI
 DB "DI,SI$"
 TCMOVB DI,BP
 DB "DI,BP$"
 TCMOVB DI,SP
 DB "DI,SP$"
 TCMOVB BP,AX
 DB "BP,AX$"
 TCMOVB BP,BX
 DB "BP,BX$"
 TCMOVB BP,CX
 DB "BP,CX$"
 TCMOVB BP,DX
 DB "BP,DX$"
 TCMOVB BP,SI
 DB "BP,SI$"
 TCMOVB BP,DI
 DB "BP,DI$"
 TCMOVB BP,SP
 DB "BP,SP$"
;-------------------------------------------------------
 TCMOVB EAX,EBX
 DB "EAX,EBX$"
 TCMOVB EAX,ECX
 DB "EAX,ECX$"
 TCMOVB EAX,EDX
 DB "EAX,EDX$"
 TCMOVB EAX,ESI
 DB "EAX,ESI$"
 TCMOVB EAX,EDI
 DB "EAX,EDI$"
 TCMOVB EAX,EBP
 DB "EAX,EBP$"
 TCMOVB EAX,ESP
 DB "EAX,ESP$"
 TCMOVB EBX,EAX
 DB "EBX,EAX$"
 TCMOVB EBX,ECX
 DB "EBX,ECX$"
 TCMOVB EBX,EDX
 DB "EBX,EDX$"
 TCMOVB EBX,ESI
 DB "EBX,ESI$"
 TCMOVB EBX,EDI
 DB "EBX,EDI$"
 TCMOVB EBX,EBP
 DB "EBX,EBP$"
 TCMOVB EBX,ESP
 DB "EBX,ESP$"
 TCMOVB ECX,EAX
 DB "ECX,EAX$"
 TCMOVB ECX,EBX
 DB "ECX,EBX$"
 TCMOVB ECX,EDX
 DB "ECX,EDX$"
 TCMOVB ECX,ESI
 DB "ECX,ESI$"
 TCMOVB ECX,EDI
 DB "ECX,EDI$"
 TCMOVB ECX,EBP
 DB "ECX,EBP$"
 TCMOVB ECX,ESP
 DB "ECX,ESP$"
 TCMOVB EDX,EAX
 DB "EDX,EAX$"
 TCMOVB EDX,EBX
 DB "EDX,EBX$"
 TCMOVB EDX,ECX
 DB "EDX,ECX$"
 TCMOVB EDX,ESI
 DB "EDX,ESI$"
 TCMOVB EDX,EDI
 DB "EDX,EDI$"
 TCMOVB EDX,EBP
 DB "EDX,EBP$"
 TCMOVB EDX,ESP
 DB "EDX,ESP$"
 TCMOVB ESI,EAX
 DB "ESI,EAX$"
 TCMOVB ESI,EBX
 DB "ESI,EBX$"
 TCMOVB ESI,ECX
 DB "ESI,ECX$"
 TCMOVB ESI,EDX
 DB "ESI,EDX$"
 TCMOVB ESI,EDI
 DB "ESI,EDI$"
 TCMOVB ESI,EBP
 DB "ESI,EBP$"
 TCMOVB ESI,ESP
 DB "ESI,ESP$"
 TCMOVB EDI,EAX
 DB "EDI,EAX$"
 TCMOVB EDI,EBX
 DB "EDI,EBX$"
 TCMOVB EDI,ECX
 DB "EDI,ECX$"
 TCMOVB EDI,EDX
 DB "EDI,EDX$"
 TCMOVB EDI,ESI
 DB "EDI,ESI$"
 TCMOVB EDI,EBP
 DB "EDI,EBP$"
 TCMOVB EDI,ESP
 DB "EDI,ESP$"
 TCMOVB EBP,EAX
 DB "EBP,EAX$"
 TCMOVB EBP,EBX
 DB "EBP,EBX$"
 TCMOVB EBP,ECX
 DB "EBP,ECX$"
 TCMOVB EBP,EDX
 DB "EBP,EDX$"
 TCMOVB EBP,ESI
 DB "EBP,ESI$"
 TCMOVB EBP,EDI
 DB "EBP,EDI$"
 TCMOVB EBP,ESP
 DB "EBP,ESP$"
 DW 0
;-------------------------------------------------------
test_cmovnb:
 DB "CMOVNB$"
 TCMOVNB AX,BX
 DB "AX,BX$"
 TCMOVNB AX,CX
 DB "AX,CX$"
 TCMOVNB AX,DX
 DB "AX,DX$"
 TCMOVNB AX,SI
 DB "AX,SI$"
 TCMOVNB AX,DI
 DB "AX,DI$"
 TCMOVNB AX,BP
 DB "AX,BP$"
 TCMOVNB AX,SP
 DB "AX,SP$"
 TCMOVNB BX,AX
 DB "BX,AX$"
 TCMOVNB BX,CX
 DB "BX,CX$"
 TCMOVNB BX,DX
 DB "BX,DX$"
 TCMOVNB BX,SI
 DB "BX,SI$"
 TCMOVNB BX,DI
 DB "BX,DI$"
 TCMOVNB BX,BP
 DB "BX,BP$"
 TCMOVNB BX,SP
 DB "BX,SP$"
 TCMOVNB CX,AX
 DB "CX,AX$"
 TCMOVNB CX,BX
 DB "CX,BX$"
 TCMOVNB CX,DX
 DB "CX,DX$"
 TCMOVNB CX,SI
 DB "CX,SI$"
 TCMOVNB CX,DI
 DB "CX,DI$"
 TCMOVNB CX,BP
 DB "CX,BP$"
 TCMOVNB CX,SP
 DB "CX,SP$"
 TCMOVNB DX,AX
 DB "DX,AX$"
 TCMOVNB DX,BX
 DB "DX,BX$"
 TCMOVNB DX,CX
 DB "DX,CX$"
 TCMOVNB DX,SI
 DB "DX,SI$"
 TCMOVNB DX,DI
 DB "DX,DI$"
 TCMOVNB DX,BP
 DB "DX,BP$"
 TCMOVNB DX,SP
 DB "DX,SP$"
 TCMOVNB SI,AX
 DB "SI,AX$"
 TCMOVNB SI,BX
 DB "SI,BX$"
 TCMOVNB SI,CX
 DB "SI,CX$"
 TCMOVNB SI,DX
 DB "SI,DX$"
 TCMOVNB SI,DI
 DB "SI,DI$"
 TCMOVNB SI,BP
 DB "SI,BP$"
 TCMOVNB SI,SP
 DB "SI,SP$"
 TCMOVNB DI,AX
 DB "DI,AX$"
 TCMOVNB DI,BX
 DB "DI,BX$"
 TCMOVNB DI,CX
 DB "DI,CX$"
 TCMOVNB DI,DX
 DB "DI,DX$"
 TCMOVNB DI,SI
 DB "DI,SI$"
 TCMOVNB DI,BP
 DB "DI,BP$"
 TCMOVNB DI,SP
 DB "DI,SP$"
 TCMOVNB BP,AX
 DB "BP,AX$"
 TCMOVNB BP,BX
 DB "BP,BX$"
 TCMOVNB BP,CX
 DB "BP,CX$"
 TCMOVNB BP,DX
 DB "BP,DX$"
 TCMOVNB BP,SI
 DB "BP,SI$"
 TCMOVNB BP,DI
 DB "BP,DI$"
 TCMOVNB BP,SP
 DB "BP,SP$"
;-------------------------------------------------------
 TCMOVNB EAX,EBX
 DB "EAX,EBX$"
 TCMOVNB EAX,ECX
 DB "EAX,ECX$"
 TCMOVNB EAX,EDX
 DB "EAX,EDX$"
 TCMOVNB EAX,ESI
 DB "EAX,ESI$"
 TCMOVNB EAX,EDI
 DB "EAX,EDI$"
 TCMOVNB EAX,EBP
 DB "EAX,EBP$"
 TCMOVNB EAX,ESP
 DB "EAX,ESP$"
 TCMOVNB EBX,EAX
 DB "EBX,EAX$"
 TCMOVNB EBX,ECX
 DB "EBX,ECX$"
 TCMOVNB EBX,EDX
 DB "EBX,EDX$"
 TCMOVNB EBX,ESI
 DB "EBX,ESI$"
 TCMOVNB EBX,EDI
 DB "EBX,EDI$"
 TCMOVNB EBX,EBP
 DB "EBX,EBP$"
 TCMOVNB EBX,ESP
 DB "EBX,ESP$"
 TCMOVNB ECX,EAX
 DB "ECX,EAX$"
 TCMOVNB ECX,EBX
 DB "ECX,EBX$"
 TCMOVNB ECX,EDX
 DB "ECX,EDX$"
 TCMOVNB ECX,ESI
 DB "ECX,ESI$"
 TCMOVNB ECX,EDI
 DB "ECX,EDI$"
 TCMOVNB ECX,EBP
 DB "ECX,EBP$"
 TCMOVNB ECX,ESP
 DB "ECX,ESP$"
 TCMOVNB EDX,EAX
 DB "EDX,EAX$"
 TCMOVNB EDX,EBX
 DB "EDX,EBX$"
 TCMOVNB EDX,ECX
 DB "EDX,ECX$"
 TCMOVNB EDX,ESI
 DB "EDX,ESI$"
 TCMOVNB EDX,EDI
 DB "EDX,EDI$"
 TCMOVNB EDX,EBP
 DB "EDX,EBP$"
 TCMOVNB EDX,ESP
 DB "EDX,ESP$"
 TCMOVNB ESI,EAX
 DB "ESI,EAX$"
 TCMOVNB ESI,EBX
 DB "ESI,EBX$"
 TCMOVNB ESI,ECX
 DB "ESI,ECX$"
 TCMOVNB ESI,EDX
 DB "ESI,EDX$"
 TCMOVNB ESI,EDI
 DB "ESI,EDI$"
 TCMOVNB ESI,EBP
 DB "ESI,EBP$"
 TCMOVNB ESI,ESP
 DB "ESI,ESP$"
 TCMOVNB EDI,EAX
 DB "EDI,EAX$"
 TCMOVNB EDI,EBX
 DB "EDI,EBX$"
 TCMOVNB EDI,ECX
 DB "EDI,ECX$"
 TCMOVNB EDI,EDX
 DB "EDI,EDX$"
 TCMOVNB EDI,ESI
 DB "EDI,ESI$"
 TCMOVNB EDI,EBP
 DB "EDI,EBP$"
 TCMOVNB EDI,ESP
 DB "EDI,ESP$"
 TCMOVNB EBP,EAX
 DB "EBP,EAX$"
 TCMOVNB EBP,EBX
 DB "EBP,EBX$"
 TCMOVNB EBP,ECX
 DB "EBP,ECX$"
 TCMOVNB EBP,EDX
 DB "EBP,EDX$"
 TCMOVNB EBP,ESI
 DB "EBP,ESI$"
 TCMOVNB EBP,EDI
 DB "EBP,EDI$"
 TCMOVNB EBP,ESP
 DB "EBP,ESP$"
 DW 0
;-------------------------------------------------------
test_cmovz:
 DB "CMOVZ$"
 TCMOVB AX,BX
 DB "AX,BX$"
 TCMOVZ AX,CX
 DB "AX,CX$"
 TCMOVZ AX,DX
 DB "AX,DX$"
 TCMOVZ AX,SI
 DB "AX,SI$"
 TCMOVZ AX,DI
 DB "AX,DI$"
 TCMOVZ AX,BP
 DB "AX,BP$"
 TCMOVZ AX,SP
 DB "AX,SP$"
 TCMOVZ BX,AX
 DB "BX,AX$"
 TCMOVZ BX,CX
 DB "BX,CX$"
 TCMOVZ BX,DX
 DB "BX,DX$"
 TCMOVZ BX,SI
 DB "BX,SI$"
 TCMOVZ BX,DI
 DB "BX,DI$"
 TCMOVZ BX,BP
 DB "BX,BP$"
 TCMOVZ BX,SP
 DB "BX,SP$"
 TCMOVZ CX,AX
 DB "CX,AX$"
 TCMOVZ CX,BX
 DB "CX,BX$"
 TCMOVZ CX,DX
 DB "CX,DX$"
 TCMOVZ CX,SI
 DB "CX,SI$"
 TCMOVZ CX,DI
 DB "CX,DI$"
 TCMOVZ CX,BP
 DB "CX,BP$"
 TCMOVZ CX,SP
 DB "CX,SP$"
 TCMOVZ DX,AX
 DB "DX,AX$"
 TCMOVZ DX,BX
 DB "DX,BX$"
 TCMOVZ DX,CX
 DB "DX,CX$"
 TCMOVZ DX,SI
 DB "DX,SI$"
 TCMOVZ DX,DI
 DB "DX,DI$"
 TCMOVZ DX,BP
 DB "DX,BP$"
 TCMOVZ DX,SP
 DB "DX,SP$"
 TCMOVZ SI,AX
 DB "SI,AX$"
 TCMOVZ SI,BX
 DB "SI,BX$"
 TCMOVZ SI,CX
 DB "SI,CX$"
 TCMOVZ SI,DX
 DB "SI,DX$"
 TCMOVZ SI,DI
 DB "SI,DI$"
 TCMOVZ SI,BP
 DB "SI,BP$"
 TCMOVZ SI,SP
 DB "SI,SP$"
 TCMOVZ DI,AX
 DB "DI,AX$"
 TCMOVZ DI,BX
 DB "DI,BX$"
 TCMOVZ DI,CX
 DB "DI,CX$"
 TCMOVZ DI,DX
 DB "DI,DX$"
 TCMOVZ DI,SI
 DB "DI,SI$"
 TCMOVZ DI,BP
 DB "DI,BP$"
 TCMOVZ DI,SP
 DB "DI,SP$"
 TCMOVZ BP,AX
 DB "BP,AX$"
 TCMOVZ BP,BX
 DB "BP,BX$"
 TCMOVZ BP,CX
 DB "BP,CX$"
 TCMOVZ BP,DX
 DB "BP,DX$"
 TCMOVZ BP,SI
 DB "BP,SI$"
 TCMOVZ BP,DI
 DB "BP,DI$"
 TCMOVZ BP,SP
 DB "BP,SP$"
;-------------------------------------------------------
 TCMOVZ EAX,EBX
 DB "EAX,EBX$"
 TCMOVZ EAX,ECX
 DB "EAX,ECX$"
 TCMOVZ EAX,EDX
 DB "EAX,EDX$"
 TCMOVZ EAX,ESI
 DB "EAX,ESI$"
 TCMOVZ EAX,EDI
 DB "EAX,EDI$"
 TCMOVZ EAX,EBP
 DB "EAX,EBP$"
 TCMOVZ EAX,ESP
 DB "EAX,ESP$"
 TCMOVZ EBX,EAX
 DB "EBX,EAX$"
 TCMOVZ EBX,ECX
 DB "EBX,ECX$"
 TCMOVZ EBX,EDX
 DB "EBX,EDX$"
 TCMOVZ EBX,ESI
 DB "EBX,ESI$"
 TCMOVZ EBX,EDI
 DB "EBX,EDI$"
 TCMOVZ EBX,EBP
 DB "EBX,EBP$"
 TCMOVZ EBX,ESP
 DB "EBX,ESP$"
 TCMOVZ ECX,EAX
 DB "ECX,EAX$"
 TCMOVZ ECX,EBX
 DB "ECX,EBX$"
 TCMOVZ ECX,EDX
 DB "ECX,EDX$"
 TCMOVZ ECX,ESI
 DB "ECX,ESI$"
 TCMOVZ ECX,EDI
 DB "ECX,EDI$"
 TCMOVZ ECX,EBP
 DB "ECX,EBP$"
 TCMOVZ ECX,ESP
 DB "ECX,ESP$"
 TCMOVZ EDX,EAX
 DB "EDX,EAX$"
 TCMOVZ EDX,EBX
 DB "EDX,EBX$"
 TCMOVZ EDX,ECX
 DB "EDX,ECX$"
 TCMOVZ EDX,ESI
 DB "EDX,ESI$"
 TCMOVZ EDX,EDI
 DB "EDX,EDI$"
 TCMOVZ EDX,EBP
 DB "EDX,EBP$"
 TCMOVZ EDX,ESP
 DB "EDX,ESP$"
 TCMOVZ ESI,EAX
 DB "ESI,EAX$"
 TCMOVZ ESI,EBX
 DB "ESI,EBX$"
 TCMOVZ ESI,ECX
 DB "ESI,ECX$"
 TCMOVZ ESI,EDX
 DB "ESI,EDX$"
 TCMOVZ ESI,EDI
 DB "ESI,EDI$"
 TCMOVZ ESI,EBP
 DB "ESI,EBP$"
 TCMOVZ ESI,ESP
 DB "ESI,ESP$"
 TCMOVZ EDI,EAX
 DB "EDI,EAX$"
 TCMOVZ EDI,EBX
 DB "EDI,EBX$"
 TCMOVZ EDI,ECX
 DB "EDI,ECX$"
 TCMOVZ EDI,EDX
 DB "EDI,EDX$"
 TCMOVZ EDI,ESI
 DB "EDI,ESI$"
 TCMOVZ EDI,EBP
 DB "EDI,EBP$"
 TCMOVZ EDI,ESP
 DB "EDI,ESP$"
 TCMOVZ EBP,EAX
 DB "EBP,EAX$"
 TCMOVZ EBP,EBX
 DB "EBP,EBX$"
 TCMOVZ EBP,ECX
 DB "EBP,ECX$"
 TCMOVZ EBP,EDX
 DB "EBP,EDX$"
 TCMOVZ EBP,ESI
 DB "EBP,ESI$"
 TCMOVZ EBP,EDI
 DB "EBP,EDI$"
 TCMOVZ EBP,ESP
 DB "EBP,ESP$"
 DW 0
;-------------------------------------------------------
test_cmovnz:
 DB "CMOVNZ$"
 TCMOVNZ AX,BX
 DB "AX,BX$"
 TCMOVNZ AX,CX
 DB "AX,CX$"
 TCMOVNZ AX,DX
 DB "AX,DX$"
 TCMOVNZ AX,SI
 DB "AX,SI$"
 TCMOVNZ AX,DI
 DB "AX,DI$"
 TCMOVNZ AX,BP
 DB "AX,BP$"
 TCMOVNZ AX,SP
 DB "AX,SP$"
 TCMOVNZ BX,AX
 DB "BX,AX$"
 TCMOVNZ BX,CX
 DB "BX,CX$"
 TCMOVNZ BX,DX
 DB "BX,DX$"
 TCMOVNZ BX,SI
 DB "BX,SI$"
 TCMOVNZ BX,DI
 DB "BX,DI$"
 TCMOVNZ BX,BP
 DB "BX,BP$"
 TCMOVNZ BX,SP
 DB "BX,SP$"
 TCMOVNZ CX,AX
 DB "CX,AX$"
 TCMOVNZ CX,BX
 DB "CX,BX$"
 TCMOVNZ CX,DX
 DB "CX,DX$"
 TCMOVNZ CX,SI
 DB "CX,SI$"
 TCMOVNZ CX,DI
 DB "CX,DI$"
 TCMOVNZ CX,BP
 DB "CX,BP$"
 TCMOVNZ CX,SP
 DB "CX,SP$"
 TCMOVNZ DX,AX
 DB "DX,AX$"
 TCMOVNZ DX,BX
 DB "DX,BX$"
 TCMOVNZ DX,CX
 DB "DX,CX$"
 TCMOVNZ DX,SI
 DB "DX,SI$"
 TCMOVNZ DX,DI
 DB "DX,DI$"
 TCMOVNZ DX,BP
 DB "DX,BP$"
 TCMOVNZ DX,SP
 DB "DX,SP$"
 TCMOVNZ SI,AX
 DB "SI,AX$"
 TCMOVNZ SI,BX
 DB "SI,BX$"
 TCMOVNZ SI,CX
 DB "SI,CX$"
 TCMOVNZ SI,DX
 DB "SI,DX$"
 TCMOVNZ SI,DI
 DB "SI,DI$"
 TCMOVNZ SI,BP
 DB "SI,BP$"
 TCMOVNZ SI,SP
 DB "SI,SP$"
 TCMOVNZ DI,AX
 DB "DI,AX$"
 TCMOVNZ DI,BX
 DB "DI,BX$"
 TCMOVNZ DI,CX
 DB "DI,CX$"
 TCMOVNZ DI,DX
 DB "DI,DX$"
 TCMOVNZ DI,SI
 DB "DI,SI$"
 TCMOVNZ DI,BP
 DB "DI,BP$"
 TCMOVNZ DI,SP
 DB "DI,SP$"
 TCMOVNZ BP,AX
 DB "BP,AX$"
 TCMOVNZ BP,BX
 DB "BP,BX$"
 TCMOVNZ BP,CX
 DB "BP,CX$"
 TCMOVNZ BP,DX
 DB "BP,DX$"
 TCMOVNZ BP,SI
 DB "BP,SI$"
 TCMOVNZ BP,DI
 DB "BP,DI$"
 TCMOVNZ BP,SP
 DB "BP,SP$"
;-------------------------------------------------------
 TCMOVNZ EAX,EBX
 DB "EAX,EBX$"
 TCMOVNZ EAX,ECX
 DB "EAX,ECX$"
 TCMOVNZ EAX,EDX
 DB "EAX,EDX$"
 TCMOVNZ EAX,ESI
 DB "EAX,ESI$"
 TCMOVNZ EAX,EDI
 DB "EAX,EDI$"
 TCMOVNZ EAX,EBP
 DB "EAX,EBP$"
 TCMOVNZ EAX,ESP
 DB "EAX,ESP$"
 TCMOVNZ EBX,EAX
 DB "EBX,EAX$"
 TCMOVNZ EBX,ECX
 DB "EBX,ECX$"
 TCMOVNZ EBX,EDX
 DB "EBX,EDX$"
 TCMOVNZ EBX,ESI
 DB "EBX,ESI$"
 TCMOVNZ EBX,EDI
 DB "EBX,EDI$"
 TCMOVNZ EBX,EBP
 DB "EBX,EBP$"
 TCMOVNZ EBX,ESP
 DB "EBX,ESP$"
 TCMOVNZ ECX,EAX
 DB "ECX,EAX$"
 TCMOVNZ ECX,EBX
 DB "ECX,EBX$"
 TCMOVNZ ECX,EDX
 DB "ECX,EDX$"
 TCMOVNZ ECX,ESI
 DB "ECX,ESI$"
 TCMOVNZ ECX,EDI
 DB "ECX,EDI$"
 TCMOVNZ ECX,EBP
 DB "ECX,EBP$"
 TCMOVNZ ECX,ESP
 DB "ECX,ESP$"
 TCMOVNZ EDX,EAX
 DB "EDX,EAX$"
 TCMOVNZ EDX,EBX
 DB "EDX,EBX$"
 TCMOVNZ EDX,ECX
 DB "EDX,ECX$"
 TCMOVNZ EDX,ESI
 DB "EDX,ESI$"
 TCMOVNZ EDX,EDI
 DB "EDX,EDI$"
 TCMOVNZ EDX,EBP
 DB "EDX,EBP$"
 TCMOVNZ EDX,ESP
 DB "EDX,ESP$"
 TCMOVNZ ESI,EAX
 DB "ESI,EAX$"
 TCMOVNZ ESI,EBX
 DB "ESI,EBX$"
 TCMOVNZ ESI,ECX
 DB "ESI,ECX$"
 TCMOVNZ ESI,EDX
 DB "ESI,EDX$"
 TCMOVNZ ESI,EDI
 DB "ESI,EDI$"
 TCMOVNZ ESI,EBP
 DB "ESI,EBP$"
 TCMOVNZ ESI,ESP
 DB "ESI,ESP$"
 TCMOVNZ EDI,EAX
 DB "EDI,EAX$"
 TCMOVNZ EDI,EBX
 DB "EDI,EBX$"
 TCMOVNZ EDI,ECX
 DB "EDI,ECX$"
 TCMOVNZ EDI,EDX
 DB "EDI,EDX$"
 TCMOVNZ EDI,ESI
 DB "EDI,ESI$"
 TCMOVNZ EDI,EBP
 DB "EDI,EBP$"
 TCMOVNZ EDI,ESP
 DB "EDI,ESP$"
 TCMOVNZ EBP,EAX
 DB "EBP,EAX$"
 TCMOVNZ EBP,EBX
 DB "EBP,EBX$"
 TCMOVNZ EBP,ECX
 DB "EBP,ECX$"
 TCMOVNZ EBP,EDX
 DB "EBP,EDX$"
 TCMOVNZ EBP,ESI
 DB "EBP,ESI$"
 TCMOVNZ EBP,EDI
 DB "EBP,EDI$"
 TCMOVNZ EBP,ESP
 DB "EBP,ESP$"
 DW 0
;-------------------------------------------------------
test_fcmovb:
 DB "FCMOVB$"
 TFCMOVB ST1
 DB "ST0,ST1$"
 TFCMOVB ST2
 DB "ST0,ST2$"
 TFCMOVB ST3
 DB "ST0,ST3$"
 TFCMOVB ST4
 DB "ST0,ST4$"
 TFCMOVB ST5
 DB "ST0,ST5$"
 TFCMOVB ST6
 DB "ST0,ST6$"
 TFCMOVB ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovnb:
 DB "FCMOVNB$"
 TFCMOVNB ST1
 DB "ST0,ST1$"
 TFCMOVNB ST2
 DB "ST0,ST2$"
 TFCMOVNB ST3
 DB "ST0,ST3$"
 TFCMOVNB ST4
 DB "ST0,ST4$"
 TFCMOVNB ST5
 DB "ST0,ST5$"
 TFCMOVNB ST6
 DB "ST0,ST6$"
 TFCMOVNB ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmove:
 DB "FCMOVE$"
 TFCMOVE ST1
 DB "ST0,ST1$"
 TFCMOVE ST2
 DB "ST0,ST2$"
 TFCMOVE ST3
 DB "ST0,ST3$"
 TFCMOVE ST4
 DB "ST0,ST4$"
 TFCMOVE ST5
 DB "ST0,ST5$"
 TFCMOVE ST6
 DB "ST0,ST6$"
 TFCMOVE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovne:
 DB "FCMOVNE$"
 TFCMOVNE ST1
 DB "ST0,ST1$"
 TFCMOVNE ST2
 DB "ST0,ST2$"
 TFCMOVNE ST3
 DB "ST0,ST3$"
 TFCMOVNE ST4
 DB "ST0,ST4$"
 TFCMOVNE ST5
 DB "ST0,ST5$"
 TFCMOVNE ST6
 DB "ST0,ST6$"
 TFCMOVNE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovu:
 DB "FCMOVU$"
 TFCMOVU ST1
 DB "ST0,ST1$"
 TFCMOVU ST2
 DB "ST0,ST2$"
 TFCMOVU ST3
 DB "ST0,ST3$"
 TFCMOVU ST4
 DB "ST0,ST4$"
 TFCMOVU ST5
 DB "ST0,ST5$"
 TFCMOVU ST6
 DB "ST0,ST6$"
 TFCMOVU ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovnu:
 DB "FCMOVNU$"
 TFCMOVNU ST1
 DB "ST0,ST1$"
 TFCMOVNU ST2
 DB "ST0,ST2$"
 TFCMOVNU ST3
 DB "ST0,ST3$"
 TFCMOVNU ST4
 DB "ST0,ST4$"
 TFCMOVNU ST5
 DB "ST0,ST5$"
 TFCMOVNU ST6
 DB "ST0,ST6$"
 TFCMOVNU ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovbe:
 DB "FCMOVBE$"
 TFCMOVBE1 ST1
 DB "ST0,ST1$"
 TFCMOVBE1 ST2
 DB "ST0,ST2$"
 TFCMOVBE1 ST3
 DB "ST0,ST3$"
 TFCMOVBE1 ST4
 DB "ST0,ST4$"
 TFCMOVBE1 ST5
 DB "ST0,ST5$"
 TFCMOVBE1 ST6
 DB "ST0,ST6$"
 TFCMOVBE1 ST7
 DB "ST0,ST7$"
 TFCMOVBE2 ST1
 DB "ST0,ST1$"
 TFCMOVBE2 ST2
 DB "ST0,ST2$"
 TFCMOVBE2 ST3
 DB "ST0,ST3$"
 TFCMOVBE2 ST4
 DB "ST0,ST4$"
 TFCMOVBE2 ST5
 DB "ST0,ST5$"
 TFCMOVBE2 ST6
 DB "ST0,ST6$"
 TFCMOVBE2 ST7
 DB "ST0,ST7$"
 TFCMOVBE3 ST1
 DB "ST0,ST1$"
 TFCMOVBE3 ST2
 DB "ST0,ST2$"
 TFCMOVBE3 ST3
 DB "ST0,ST3$"
 TFCMOVBE3 ST4
 DB "ST0,ST4$"
 TFCMOVBE3 ST5
 DB "ST0,ST5$"
 TFCMOVBE3 ST6
 DB "ST0,ST6$"
 TFCMOVBE3 ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcmovnbe:
 DB "FCMOVNBE$"
 TFCMOVNBE1 ST1
 DB "ST0,ST1$"
 TFCMOVNBE1 ST2
 DB "ST0,ST2$"
 TFCMOVNBE1 ST3
 DB "ST0,ST3$"
 TFCMOVNBE1 ST4
 DB "ST0,ST4$"
 TFCMOVNBE1 ST5
 DB "ST0,ST5$"
 TFCMOVNBE1 ST6
 DB "ST0,ST6$"
 TFCMOVNBE1 ST7
 DB "ST0,ST7$"
 TFCMOVNBE2 ST1
 DB "ST0,ST1$"
 TFCMOVNBE2 ST2
 DB "ST0,ST2$"
 TFCMOVNBE2 ST3
 DB "ST0,ST3$"
 TFCMOVNBE2 ST4
 DB "ST0,ST4$"
 TFCMOVNBE2 ST5
 DB "ST0,ST5$"
 TFCMOVNBE2 ST6
 DB "ST0,ST6$"
 TFCMOVNBE2 ST7
 DB "ST0,ST7$"
 TFCMOVNBE3 ST1
 DB "ST0,ST1$"
 TFCMOVNBE3 ST2
 DB "ST0,ST2$"
 TFCMOVNBE3 ST3
 DB "ST0,ST3$"
 TFCMOVNBE3 ST4
 DB "ST0,ST4$"
 TFCMOVNBE3 ST5
 DB "ST0,ST5$"
 TFCMOVNBE3 ST6
 DB "ST0,ST6$"
 TFCMOVNBE3 ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcomi:
 DB "FCOMI$"
 TFCOMIA ST1
 DB "ST0,ST1$"
 TFCOMIA ST2
 DB "ST0,ST2$"
 TFCOMIA ST3
 DB "ST0,ST3$"
 TFCOMIA ST4
 DB "ST0,ST4$"
 TFCOMIA ST5
 DB "ST0,ST5$"
 TFCOMIA ST6
 DB "ST0,ST6$"
 TFCOMIA ST7
 DB "ST0,ST7$"
 TFCOMIB ST1
 DB "ST0,ST1$"
 TFCOMIB ST2
 DB "ST0,ST2$"
 TFCOMIB ST3
 DB "ST0,ST3$"
 TFCOMIB ST4
 DB "ST0,ST4$"
 TFCOMIB ST5
 DB "ST0,ST5$"
 TFCOMIB ST6
 DB "ST0,ST6$"
 TFCOMIB ST7
 DB "ST0,ST7$"
 TFCOMIE ST1
 DB "ST0,ST1$"
 TFCOMIE ST2
 DB "ST0,ST2$"
 TFCOMIE ST3
 DB "ST0,ST3$"
 TFCOMIE ST4
 DB "ST0,ST4$"
 TFCOMIE ST5
 DB "ST0,ST5$"
 TFCOMIE ST6
 DB "ST0,ST6$"
 TFCOMIE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fcomip:
 DB "FCOMIP$"
 TFCOMIPA ST1
 DB "ST0,ST1$"
 TFCOMIPA ST2
 DB "ST0,ST2$"
 TFCOMIPA ST3
 DB "ST0,ST3$"
 TFCOMIPA ST4
 DB "ST0,ST4$"
 TFCOMIPA ST5
 DB "ST0,ST5$"
 TFCOMIPA ST6
 DB "ST0,ST6$"
 TFCOMIPA ST7
 DB "ST0,ST7$"
 TFCOMIPB ST1
 DB "ST0,ST1$"
 TFCOMIPB ST2
 DB "ST0,ST2$"
 TFCOMIPB ST3
 DB "ST0,ST3$"
 TFCOMIPB ST4
 DB "ST0,ST4$"
 TFCOMIPB ST5
 DB "ST0,ST5$"
 TFCOMIPB ST6
 DB "ST0,ST6$"
 TFCOMIPB ST7
 DB "ST0,ST7$"
 TFCOMIPE ST1
 DB "ST0,ST1$"
 TFCOMIPE ST2
 DB "ST0,ST2$"
 TFCOMIPE ST3
 DB "ST0,ST3$"
 TFCOMIPE ST4
 DB "ST0,ST4$"
 TFCOMIPE ST5
 DB "ST0,ST5$"
 TFCOMIPE ST6
 DB "ST0,ST6$"
 TFCOMIPE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fucomi:
 DB "FUCOMI$"
 TFUCOMIA ST1
 DB "ST0,ST1$"
 TFUCOMIA ST2
 DB "ST0,ST2$"
 TFUCOMIA ST3
 DB "ST0,ST3$"
 TFUCOMIA ST4
 DB "ST0,ST4$"
 TFUCOMIA ST5
 DB "ST0,ST5$"
 TFUCOMIA ST6
 DB "ST0,ST6$"
 TFUCOMIA ST7
 DB "ST0,ST7$"
 TFUCOMIB ST1
 DB "ST0,ST1$"
 TFUCOMIB ST2
 DB "ST0,ST2$"
 TFUCOMIB ST3
 DB "ST0,ST3$"
 TFUCOMIB ST4
 DB "ST0,ST4$"
 TFUCOMIB ST5
 DB "ST0,ST5$"
 TFUCOMIB ST6
 DB "ST0,ST6$"
 TFUCOMIB ST7
 DB "ST0,ST7$"
 TFUCOMIE ST1
 DB "ST0,ST1$"
 TFUCOMIE ST2
 DB "ST0,ST2$"
 TFUCOMIE ST3
 DB "ST0,ST3$"
 TFUCOMIE ST4
 DB "ST0,ST4$"
 TFUCOMIE ST5
 DB "ST0,ST5$"
 TFUCOMIE ST6
 DB "ST0,ST6$"
 TFUCOMIE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_fucomip:
 DB "FUCOMIP$"
 TFUCOMIPA ST1
 DB "ST0,ST1$"
 TFUCOMIPA ST2
 DB "ST0,ST2$"
 TFUCOMIPA ST3
 DB "ST0,ST3$"
 TFUCOMIPA ST4
 DB "ST0,ST4$"
 TFUCOMIPA ST5
 DB "ST0,ST5$"
 TFUCOMIPA ST6
 DB "ST0,ST6$"
 TFUCOMIPA ST7
 DB "ST0,ST7$"
 TFUCOMIPB ST1
 DB "ST0,ST1$"
 TFUCOMIPB ST2
 DB "ST0,ST2$"
 TFUCOMIPB ST3
 DB "ST0,ST3$"
 TFUCOMIPB ST4
 DB "ST0,ST4$"
 TFUCOMIPB ST5
 DB "ST0,ST5$"
 TFUCOMIPB ST6
 DB "ST0,ST6$"
 TFUCOMIPB ST7
 DB "ST0,ST7$"
 TFUCOMIPE ST1
 DB "ST0,ST1$"
 TFUCOMIPE ST2
 DB "ST0,ST2$"
 TFUCOMIPE ST3
 DB "ST0,ST3$"
 TFUCOMIPE ST4
 DB "ST0,ST4$"
 TFUCOMIPE ST5
 DB "ST0,ST5$"
 TFUCOMIPE ST6
 DB "ST0,ST6$"
 TFUCOMIPE ST7
 DB "ST0,ST7$"
 DW 0
;-------------------------------------------------------
test_force_okay:
 DB "force okay:$"
 SUB AX,AX
 INC AX
 RETN
 DB "$"
 DW 0
;-------------------------------------------------------
test_force_fail:
 DB "force fail:$"
 SUB AX,AX
 RETN
 DB "FAIL$"
 DW 0
;-------------------------------------------------------
; BSS
stdstack  DW ?
pointer   DW ?
pointer2  DW ?
jump      DW ?
iloffset  DW ?
ilsegment DW ?
